<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>MİTHES</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Nunito+Sans:ital,wght@0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
</head>

<body class="portfolio-details-page">

  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex flex-column align-items-start me-auto me-xl-0">
        <h1 class="sitename">MİTHES</h1>
        <span class="logo-subtext">tracing & heating solution</span>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="#hero" class="active">Anasayfa</a></li>
          <li><a href="#about">Hakkımızda</a></li>
          <li class="dropdown"><a href="#portfolio"><span>Ürünlerimiz</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="#">Varil Isıtıcılar</a></li>
              <li><a href="#">IBC Tank Isıtıcı</a></li>
              <li><a href="#">Esnek Boru Isıtıcıları / Isıtıcı Bantlar</a></li>
              <li><a href="#">İzolasyon Ceketleri</a></li>
              <li><a href="#">Özel İmalat Isıtıcı Ceketleri</a></li>
              <li><a href="#">Tüp Isıtıcı</a></li>
              <li><a href="#">Isıtıcı Kablolar</a></li>
              <li><a href="#">Sıcaklık Kontrol Cihazları</a></li>
              <li><a href="#">Bağlantı Kutuları</a></li>
              <li><a href="#">Bağlantı Kitleri</a></li>
            </ul>
          </li>
          <li><a href="#contact">İletişim</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <!-- Sepet ikonu -->
      <a href="starter-page.html" class="cart-icon ms-3 position-relative">
        <i class="bi bi-cart3" style="font-size: 1.5rem;"></i>
        <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display:none;">0</span>
      </a>

    </div>
  </header>

  <main class="main">

    <!-- Sayfa Başlığı -->
    <div class="page-title dark-background" data-aos="fade">
      <div class="container position-relative">
        <h1>Ürün Detayları</h1>
        <p>Seçtiğiniz ürünle ilgili tüm teknik detaylara buradan ulaşabilir ve teklif talebinde bulunabilirsiniz.</p>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Anasayfa</a></li>
            <li class="current">Ürün Detayları</li>
          </ol>
        </nav>
      </div>
    </div>
    <!-- End Page Title -->

    <!-- Ürün Detayları Bölümü -->
    <section id="portfolio-details" class="portfolio-details section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row gy-4">
          <!-- Ürün görselleri -->
          <div class="col-lg-6" data-aos="fade-right">
            <div class="portfolio-details-media">
              <div class="main-image">
                <div class="portfolio-details-slider swiper init-swiper" data-aos="zoom-in">
                  <script type="application/json" class="swiper-config">{
                    "loop": true,
                    "speed": 1000,
                    "autoplay": { "delay": 6000 },
                    "effect": "creative",
                    "creativeEffect": {
                      "prev": { "shadow": true, "translate": [0, 0, -400] },
                      "next": { "translate": ["100%", 0, 0] }
                    },
                    "slidesPerView": 1,
                    "navigation": {
                      "nextEl": ".swiper-button-next",
                      "prevEl": ".swiper-button-prev"
                    }
                  }</script>

                  <div class="swiper-wrapper">
                    <!-- Dinamik resimler buraya eklenecek -->
                  </div>

                  <div class="swiper-button-prev"></div>
                  <div class="swiper-button-next"></div>
                </div>
              </div>

              <div class="thumbnail-grid" data-aos="fade-up" data-aos-delay="200">
                <div class="row g-2 mt-3">
                  <!-- Dinamik thumbnail resimler buraya eklenecek -->
                </div>
              </div>
            </div>
          </div>

          <!-- Ürün metin ve detayları -->
          <div class="col-lg-6" data-aos="fade-left">
            <div class="portfolio-details-content">

              <h2 class="project-title">Ürün İsmi Yükleniyor...</h2>

              <div class="project-meta">
                <div class="badge-wrapper">
                  <span class="project-badge">Kategori: Yükleniyor...</span>
                </div>
                <div class="date-client">
                  <div class="meta-item">
                    <i class="bi bi-calendar-check"></i> <span>Güncellenme: Yükleniyor...</span>
                  </div>
                  <div class="meta-item">
                    <i class="bi bi-box"></i> <span>Stok Durumu: Yükleniyor...</span>
                  </div>
                </div>
              </div>

              <div class="project-overview mt-3">
                <p class="lead">Açıklama yükleniyor...</p>

                <div class="accordion project-accordion" id="product-details-accordion">

<!-- Model/Seri seçimi için kart -->
<div id="series-panel-slot" class="series-panel mb-3" data-aos="fade-up">
  <label class="mb-2" for="series-select">Model / Seri</label>
  <select id="series-select" class="form-select form-select-sm" disabled>
    <option>Yükleniyor...</option>
  </select>
  <div class="series-meta">
    <span class="series-price" id="series-price">—</span>
    <span class="series-hint" id="series-hint">Seçtiğiniz modele göre teknik özellikler altta güncellenecektir.</span>
  </div>
</div>


                  <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-specs">
                      <!-- AÇIK BAŞLATILSIN -->
                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-specs" aria-expanded="true" aria-controls="collapse-specs">
                        <i class="bi bi-list-check me-2"></i> Teknik Özellikler
                      </button>
                    </h2>
                    <!-- AÇIK BAŞLATILSIN -->
                    <div id="collapse-specs" class="accordion-collapse collapse show" aria-labelledby="heading-specs" data-bs-parent="#product-details-accordion">
                      <div class="accordion-body specs-content">
                        <!-- Seri seçimi + teknik özellikler buraya render edilecek -->
                        <p>Yükleniyor...</p>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item" data-aos="fade-up" data-aos-delay="200">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-options" aria-expanded="false" aria-controls="collapse-options">
                        <i class="bi bi-gear me-2"></i> Opsiyonel Özellikler
                      </button>
                    </h2>
                    <div id="collapse-options" class="accordion-collapse collapse" data-bs-parent="#product-details-accordion">
                      <div class="accordion-body options-content">
                        <!-- Opsiyonel özellikler buraya -->
                        <p>Yükleniyor...</p>
                      </div>
                    </div>
                  </div>

                </div>

                <div class="cta-buttons mt-4" data-aos="fade-up" data-aos-delay="400">
                  <a href="#" id="add-to-cart-btn" class="btn-view-project">
                    <i class="bi bi-cart-plus"></i> Sepete Ekle
                  </a>
                  <a href="starter-page.html" class="btn-next-project">Sepeti Görüntüle <i class="bi bi-arrow-right-circle"></i></a>
                </div>

                <!-- === FE SCRIPT (ÜRÜN & SERİLER) === -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const API_BASE = 'http://localhost:8080';

  const trCur = new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY', maximumFractionDigits: 0 });
  const absUrl = (u) => {
    if (!u) return '';
    if (/^https?:\/\//i.test(u)) return u;
    return u.startsWith('/') ? API_BASE + u : API_BASE + '/' + u;
  };

  const params = new URLSearchParams(location.search);
  const productId = params.get('id');
  if (!productId) return;

  // DOM
  const titleEl = document.querySelector('.project-title');
  const badgeEl = document.querySelector('.project-badge');
  const leadEl  = document.querySelector('.project-overview .lead');
  const descEl  = document.querySelector('.description-content'); // olabilir / olmayabilir
  const specsEl = document.querySelector('.specs-content');
  const optionsEl = document.querySelector('.options-content');
  const swiperWrapper = document.querySelector('.swiper-wrapper');
  const thumbGrid = document.querySelector('.thumbnail-grid .row');
  const addToCartBtn = document.getElementById('add-to-cart-btn');
  const cartCountEl  = document.getElementById('cart-count');

  // Seri paneli
  const seriesPanel   = document.getElementById('series-panel-slot');
  const seriesSelect  = document.getElementById('series-select');
  const seriesPriceEl = document.getElementById('series-price');
  const seriesHintEl  = document.getElementById('series-hint');

  let product = null;
  let selectedSeries = null;

  const openAccordion = (id) => {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.add('show');
    const btn = document.querySelector(`[data-bs-target="#${id}"]`);
    if (btn) btn.setAttribute('aria-expanded','true');
  };

  const updateCartBadge = () => {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const total = cart.reduce((a, i) => a + (i.quantity || 0), 0);
    if (cartCountEl) {
      cartCountEl.textContent = total;
      cartCountEl.style.display = total > 0 ? 'inline' : 'none';
    }
  };

  const renderSpecsGrid = (targetEl, specs) => {
    if (!targetEl) return;
    if (!specs || !Object.keys(specs).length) {
      targetEl.innerHTML = '<p>Teknik özellik bulunamadı.</p>';
      return;
    }
    targetEl.innerHTML = `
      <div class="row">
        ${Object.entries(specs).map(([k,v]) => `
          <div class="col-12 col-md-6 mb-2">
            <span class="fw-bold">${k}:</span> <span>${v}</span>
          </div>
        `).join('')}
      </div>`;
  };

  // Seri panelini doldur & değişimde specs’i güncelle
  const mountSeriesPanel = (seriesList, isFallback = false) => {
    if (!seriesPanel || !seriesSelect) return;

    seriesSelect.innerHTML = seriesList.map((s, i) =>
      `<option value="${s.id}" ${i===0 ? 'selected' : ''}>${s.seriesCode}</option>`
    ).join('');

    // disabled güvenli kaldır
    seriesSelect.disabled = !!isFallback;
    if (!isFallback) seriesSelect.removeAttribute('disabled');

    selectedSeries = seriesList[0] || null;
    seriesPriceEl.textContent = selectedSeries?.price ? trCur.format(Number(selectedSeries.price)) : '—';
    seriesHintEl.textContent = isFallback
      ? 'Bu ürün için ayrı seri tanımı yok. Genel teknik özellikler gösterilmektedir.'
      : 'Seçtiğiniz modele göre teknik özellikler altta güncellenir.';

    renderSpecsGrid(specsEl, selectedSeries?.technicalSpecs || {});

    if (!isFallback) {
      seriesSelect.onchange = () => {
        const id = String(seriesSelect.value);
        selectedSeries = seriesList.find(s => String(s.id) === id) || seriesList[0];
        seriesPriceEl.textContent = selectedSeries?.price ? trCur.format(Number(selectedSeries.price)) : '—';
        renderSpecsGrid(specsEl, selectedSeries?.technicalSpecs || {});
      };
    }
  };

  // Response normalizasyonu: {data:{…}} | [ {…} ] | {…}
  const normalizeProduct = (raw) => {
    let p = (raw && typeof raw === 'object' && 'data' in raw) ? raw.data : raw;
    if (Array.isArray(p)) p = p[0] || null;
    return (p && typeof p === 'object') ? p : null;
  };

  // === ÜRÜN ===
  fetch(`${API_BASE}/api/products/${encodeURIComponent(productId)}`)
    .then(r => { if (!r.ok) throw new Error('Ürün bulunamadı'); return r.json(); })
    .then(raw => {
      product = normalizeProduct(raw);
      if (!product) throw new Error('Geçersiz ürün verisi');

      // Başlık / kategori / açıklama
      const catText = product.categoryName
        || (product.category && (product.category.name || product.category))
        || 'Bilinmiyor';

      titleEl.textContent = product.name || 'İsim yok';
      badgeEl.textContent = `Kategori: ${catText}`;
      leadEl.textContent  = product.description || '';
      if (descEl) {
        const firstP = descEl.querySelector('p');
        if (firstP) firstP.textContent = product.description || '';
      }

      // Seri listesi
      const rawSeries = product.seriesList || product.serieslist || product.series || [];
      const seriesList = Array.isArray(rawSeries) ? rawSeries.map(s => ({
        id: s.id,
        seriesCode: s.seriesCode,
        price: Number(s.price || 0),
        technicalSpecs: s.technicalSpecs || {}
      })) : [];

      if (seriesList.length) {
        mountSeriesPanel(seriesList, false);
      } else if (product.technicalSpecs && Object.keys(product.technicalSpecs).length) {
        mountSeriesPanel([{
          id: 'base', seriesCode: 'Genel',
          price: Number(product.price || 0),
          technicalSpecs: product.technicalSpecs
        }], true);
      } else {
        if (seriesSelect) {
          seriesSelect.innerHTML = `<option>Seri bulunamadı</option>`;
          seriesSelect.disabled = true;
        }
        renderSpecsGrid(specsEl, {});
      }

      // Teknik Özellikler açık
      openAccordion('collapse-specs');

      // Opsiyonel
      if (Array.isArray(product.optionalFeatures) && product.optionalFeatures.length) {
        optionsEl.innerHTML = product.optionalFeatures.map(o => `<p>${o}</p>`).join('');
      } else {
        optionsEl.innerHTML = '<p>Opsiyonel özellik yok.</p>';
      }

      // Görseller
      swiperWrapper.innerHTML = '';
      if (Array.isArray(product.images) && product.images.length) {
        product.images.forEach(url => {
          const slide = document.createElement('div');
          slide.className = 'swiper-slide';
          slide.innerHTML = `<img src="${absUrl(url)}" alt="${product.name || ''}" class="img-fluid">`;
          swiperWrapper.appendChild(slide);
        });
      } else {
        const url = product.imageUrl || '/assets/img/placeholder.webp';
        swiperWrapper.innerHTML = `
          <div class="swiper-slide">
            <img src="${absUrl(url)}" alt="${product.name || ''}" class="img-fluid">
          </div>`;
      }

      // Thumbs (varsa)
      thumbGrid.innerHTML = '';
      if (Array.isArray(product.thumbnails) && product.thumbnails.length) {
        product.thumbnails.forEach(url => {
          const col = document.createElement('div');
          col.className = 'col-3';
          col.innerHTML = `<img src="${absUrl(url)}" class="img-fluid glightbox" alt="${product.name || ''}">`;
          thumbGrid.appendChild(col);
        });
      }

      // Swiper: tek slide ise loop/ok kapat
      try {
        const swiperEl = document.querySelector('.init-swiper');
        const prevBtn = document.querySelector('.swiper-button-prev');
        const nextBtn = document.querySelector('.swiper-button-next');
        if (swiperEl && swiperEl.swiper) {
          const sw = swiperEl.swiper;
          const count = sw.slides?.length || 0;
          if (count < 2) {
            sw.params.loop = false;
            if (typeof sw.loopDestroy === 'function') sw.loopDestroy();
            sw.update();
            if (prevBtn) prevBtn.style.display = 'none';
            if (nextBtn) nextBtn.style.display = 'none';
          } else {
            sw.update();
          }
        }
      } catch (_) {}

      updateCartBadge();
    })
    .catch(err => {
      console.error('Ürün detayları yüklenirken hata:', err);
      const firstP = descEl ? descEl.querySelector('p') : null;
      if (firstP) {
        firstP.innerHTML = `<span class="text-danger">Ürün yüklenemedi: ${err?.message || err}</span>`;
      } else if (leadEl) {
        leadEl.innerHTML = `<span class="text-danger">Ürün yüklenemedi: ${err?.message || err}</span>`;
      }
      if (swiperWrapper && !swiperWrapper.children.length) {
        swiperWrapper.innerHTML = `
          <div class="swiper-slide">
            <img src="/assets/img/placeholder.webp" class="img-fluid" alt="placeholder">
          </div>`;
      }
    });

  // Sepete ekle
  if (addToCartBtn) {
    addToCartBtn.addEventListener('click', (e) => {
      e.preventDefault();
      if (!product) return;
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');

      if (selectedSeries) {
        const existing = cart.find(i => i.seriesId === selectedSeries.id);
        if (existing) existing.quantity += 1;
        else cart.push({
          id: product.id,
          name: product.name,
          seriesId: selectedSeries.id,
          seriesCode: selectedSeries.seriesCode,
          price: Number(selectedSeries.price || 0),
          quantity: 1
        });
      } else {
        const existing = cart.find(i => i.id === product.id && !i.seriesId);
        if (existing) existing.quantity += 1;
        else cart.push({ id: product.id, name: product.name, price: Number(product.price || 0), quantity: 1 });
      }

      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartBadge();
      alert(`${product.name}${selectedSeries ? ' (' + selectedSeries.seriesCode + ')' : ''} sepete eklendi!`);
    });
  }
});
</script>




                <!-- === /FE SCRIPT === -->

              </div>
            </div>
          </div>

        </div>

      </div>

    </section>

  </main>

  <footer id="footer" class="footer">

  <div class="container footer-top">
    <div class="row gy-4">

      <div class="col-lg-5 col-md-12 footer-about">
        <a href="index.html" class="logo d-flex align-items-center">
          <span class="sitename">Mithes</span>
        </a>
        <p>
          Mithes, endüstriyel ısıtma çözümlerinde uzmanlaşmış, yüksek kaliteli varil ısıtıcıları,
          IBC tank ısıtıcıları, esnek boru ısıtıcıları ve izolasyon ceketleri sunan güvenilir bir markadır.
        </p>
        <div class="social-links d-flex mt-4">
          <a href="https://twitter.com/mithes" target="_blank" rel="noopener"><i class="bi bi-twitter"></i></a>
          <a href="https://www.facebook.com/mithes" target="_blank" rel="noopener"><i class="bi bi-facebook"></i></a>
          <a href="https://www.instagram.com/mithes" target="_blank" rel="noopener"><i class="bi bi-instagram"></i></a>
          <a href="https://www.linkedin.com/company/mithes" target="_blank" rel="noopener"><i class="bi bi-linkedin"></i></a>
        </div>
      </div>

      <div class="col-lg-2 col-6 footer-links">
        <h4>Hızlı Linkler</h4>
        <ul>
          <li><a href="index.html">Anasayfa</a></li>
          <li><a href="about.html">Hakkımızda</a></li>
          <li><a href="products.html">Ürünler</a></li>
          <li><a href="contact.html">İletişim</a></li>
          <li><a href="privacy.html">Gizlilik Politikası</a></li>
        </ul>
      </div>

      <div class="col-lg-2 col-6 footer-links">
        <h4>Ürün Kategorileri</h4>
        <ul>
          <li><a href="products.html#varil-isiticilar">Varil Isıtıcılar</a></li>
          <li><a href="products.html#ibc-tank-isiticilar">IBC Tank Isıtıcı</a></li>
          <li><a href="products.html#boru-isiticilar">Esnek Boru Isıtıcıları</a></li>
          <li><a href="products.html#izolasyon-ceketleri">İzolasyon Ceketleri</a></li>
          <li><a href="products.html#ozel-imalat">Özel İmalat Ceketler</a></li>
        </ul>
      </div>

      <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
        <h4>İletişim</h4>
        <p>Soğanlık Yeni Mah. Pegagaz Sok.Pega Kartal MTM Elektrik A.Ş.</p>
        <p>İstanbul, Türkiye</p>
        <p>
          <strong>Telefon:</strong> <span>+90 216 523 49 00</span><br>
          <strong>Email:</strong> <span>mtm@mtmelektrik.com</span>
        </p>
      </div>

    </div>
  </div>

  <div class="container copyright text-center mt-4">
    <p>© <span>2025</span> <strong class="px-1 sitename">Mithes</strong>. Tüm Hakları Saklıdır.</p>
    <div class="credits">
      Designed by <a href="https://tyonex.com.tr/" target="_blank" rel="noopener">TYONEX</a>
    </div>
  </div>

</footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>
